{"version":3,"file":"index.cjs","names":["isNetworkError"],"sources":["../../../../../../../../node_modules/.pnpm/p-retry@7.1.0/node_modules/p-retry/index.js"],"sourcesContent":["import isNetworkError from 'is-network-error';\n\nfunction validateRetries(retries) {\n\tif (typeof retries === 'number') {\n\t\tif (retries < 0) {\n\t\t\tthrow new TypeError('Expected `retries` to be a non-negative number.');\n\t\t}\n\n\t\tif (Number.isNaN(retries)) {\n\t\t\tthrow new TypeError('Expected `retries` to be a valid number or Infinity, got NaN.');\n\t\t}\n\t} else if (retries !== undefined) {\n\t\tthrow new TypeError('Expected `retries` to be a number or Infinity.');\n\t}\n}\n\nfunction validateNumberOption(name, value, {min = 0, allowInfinity = false} = {}) {\n\tif (value === undefined) {\n\t\treturn;\n\t}\n\n\tif (typeof value !== 'number' || Number.isNaN(value)) {\n\t\tthrow new TypeError(`Expected \\`${name}\\` to be a number${allowInfinity ? ' or Infinity' : ''}.`);\n\t}\n\n\tif (!allowInfinity && !Number.isFinite(value)) {\n\t\tthrow new TypeError(`Expected \\`${name}\\` to be a finite number.`);\n\t}\n\n\tif (value < min) {\n\t\tthrow new TypeError(`Expected \\`${name}\\` to be \\u2265 ${min}.`);\n\t}\n}\n\nexport class AbortError extends Error {\n\tconstructor(message) {\n\t\tsuper();\n\n\t\tif (message instanceof Error) {\n\t\t\tthis.originalError = message;\n\t\t\t({message} = message);\n\t\t} else {\n\t\t\tthis.originalError = new Error(message);\n\t\t\tthis.originalError.stack = this.stack;\n\t\t}\n\n\t\tthis.name = 'AbortError';\n\t\tthis.message = message;\n\t}\n}\n\nfunction calculateDelay(retriesConsumed, options) {\n\tconst attempt = Math.max(1, retriesConsumed + 1);\n\tconst random = options.randomize ? (Math.random() + 1) : 1;\n\n\tlet timeout = Math.round(random * options.minTimeout * (options.factor ** (attempt - 1)));\n\ttimeout = Math.min(timeout, options.maxTimeout);\n\n\treturn timeout;\n}\n\nfunction calculateRemainingTime(start, max) {\n\tif (!Number.isFinite(max)) {\n\t\treturn max;\n\t}\n\n\treturn max - (performance.now() - start);\n}\n\nasync function onAttemptFailure({error, attemptNumber, retriesConsumed, startTime, options}) {\n\tconst normalizedError = error instanceof Error\n\t\t? error\n\t\t: new TypeError(`Non-error was thrown: \"${error}\". You should only throw errors.`);\n\n\tif (normalizedError instanceof AbortError) {\n\t\tthrow normalizedError.originalError;\n\t}\n\n\tconst retriesLeft = Number.isFinite(options.retries)\n\t\t? Math.max(0, options.retries - retriesConsumed)\n\t\t: options.retries;\n\n\tconst maxRetryTime = options.maxRetryTime ?? Number.POSITIVE_INFINITY;\n\n\tconst context = Object.freeze({\n\t\terror: normalizedError,\n\t\tattemptNumber,\n\t\tretriesLeft,\n\t\tretriesConsumed,\n\t});\n\n\tawait options.onFailedAttempt(context);\n\n\tif (calculateRemainingTime(startTime, maxRetryTime) <= 0) {\n\t\tthrow normalizedError;\n\t}\n\n\tconst consumeRetry = await options.shouldConsumeRetry(context);\n\n\tconst remainingTime = calculateRemainingTime(startTime, maxRetryTime);\n\n\tif (remainingTime <= 0 || retriesLeft <= 0) {\n\t\tthrow normalizedError;\n\t}\n\n\tif (normalizedError instanceof TypeError && !isNetworkError(normalizedError)) {\n\t\tif (consumeRetry) {\n\t\t\tthrow normalizedError;\n\t\t}\n\n\t\toptions.signal?.throwIfAborted();\n\t\treturn false;\n\t}\n\n\tif (!await options.shouldRetry(context)) {\n\t\tthrow normalizedError;\n\t}\n\n\tif (!consumeRetry) {\n\t\toptions.signal?.throwIfAborted();\n\t\treturn false;\n\t}\n\n\tconst delayTime = calculateDelay(retriesConsumed, options);\n\tconst finalDelay = Math.min(delayTime, remainingTime);\n\n\tif (finalDelay > 0) {\n\t\tawait new Promise((resolve, reject) => {\n\t\t\tconst onAbort = () => {\n\t\t\t\tclearTimeout(timeoutToken);\n\t\t\t\toptions.signal?.removeEventListener('abort', onAbort);\n\t\t\t\treject(options.signal.reason);\n\t\t\t};\n\n\t\t\tconst timeoutToken = setTimeout(() => {\n\t\t\t\toptions.signal?.removeEventListener('abort', onAbort);\n\t\t\t\tresolve();\n\t\t\t}, finalDelay);\n\n\t\t\tif (options.unref) {\n\t\t\t\ttimeoutToken.unref?.();\n\t\t\t}\n\n\t\t\toptions.signal?.addEventListener('abort', onAbort, {once: true});\n\t\t});\n\t}\n\n\toptions.signal?.throwIfAborted();\n\n\treturn true;\n}\n\nexport default async function pRetry(input, options = {}) {\n\toptions = {...options};\n\n\tvalidateRetries(options.retries);\n\n\tif (Object.hasOwn(options, 'forever')) {\n\t\tthrow new Error('The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.');\n\t}\n\n\toptions.retries ??= 10;\n\toptions.factor ??= 2;\n\toptions.minTimeout ??= 1000;\n\toptions.maxTimeout ??= Number.POSITIVE_INFINITY;\n\toptions.maxRetryTime ??= Number.POSITIVE_INFINITY;\n\toptions.randomize ??= false;\n\toptions.onFailedAttempt ??= () => {};\n\toptions.shouldRetry ??= () => true;\n\toptions.shouldConsumeRetry ??= () => true;\n\n\t// Validate numeric options and normalize edge cases\n\tvalidateNumberOption('factor', options.factor, {min: 0, allowInfinity: false});\n\tvalidateNumberOption('minTimeout', options.minTimeout, {min: 0, allowInfinity: false});\n\tvalidateNumberOption('maxTimeout', options.maxTimeout, {min: 0, allowInfinity: true});\n\tvalidateNumberOption('maxRetryTime', options.maxRetryTime, {min: 0, allowInfinity: true});\n\n\t// Treat non-positive factor as 1 to avoid zero backoff or negative behavior\n\tif (!(options.factor > 0)) {\n\t\toptions.factor = 1;\n\t}\n\n\toptions.signal?.throwIfAborted();\n\n\tlet attemptNumber = 0;\n\tlet retriesConsumed = 0;\n\tconst startTime = performance.now();\n\n\twhile (Number.isFinite(options.retries) ? retriesConsumed <= options.retries : true) {\n\t\tattemptNumber++;\n\n\t\ttry {\n\t\t\toptions.signal?.throwIfAborted();\n\n\t\t\tconst result = await input(attemptNumber);\n\n\t\t\toptions.signal?.throwIfAborted();\n\n\t\t\treturn result;\n\t\t} catch (error) {\n\t\t\tif (await onAttemptFailure({\n\t\t\t\terror,\n\t\t\t\tattemptNumber,\n\t\t\t\tretriesConsumed,\n\t\t\t\tstartTime,\n\t\t\t\toptions,\n\t\t\t})) {\n\t\t\t\tretriesConsumed++;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Should not reach here, but in case it does, throw an error\n\tthrow new Error('Retry attempts exhausted without throwing an error.');\n}\n\nexport function makeRetriable(function_, options) {\n\treturn function (...arguments_) {\n\t\treturn pRetry(() => function_.apply(this, arguments_), options);\n\t};\n}\n"],"x_google_ignoreList":[0],"mappings":"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"}